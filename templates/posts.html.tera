{% macro draw_embed(title="DIVA Mod Archive", description="", image="", author="DIVA Mod Archive") %}
<title>{{ title }} - DIVA Mod Archive</title>
<meta property="og:title" content="{{ title }}">
{% if description != "" %}
<meta property="og:description" content="{{ description }}">
{% endif %}
{% if image != "" %}
<meta property="og:image" content="{{ image }}">
<meta name="twitter:card" content="summary_large_image">
{% endif %}
<meta property="og:site_name" content="{{ author }}">

<style>
	@media (min-width: 768px) {
		.text-align-right-md {
			text-align: right;
		}
	}
</style>

{% endmacro draw_embed %}

{% macro draw_post_short(id, name, text_short, image, likes, dislikes, downloads) %}
<div class="col">
	<a class="card shadow-sm" title="{{ text_short | striptags }}" style="text-decoration: none;"
		href="/posts/{{ id }}">
		<div class="card-img-top ratio ratio-16x9">
			<img class="hoverUnhide" src="{{ image }}" width="100%" height="225" crossorigin="anonymous">
		</div>
		<div class="card-body">
			<h4 class="text">{{ name | striptags | truncate(length=15) }}</h4>
			<h7 class="text">{{ likes }}👍{{ dislikes }}👎 Downloads: {{ downloads }}</h7>
		</div>
	</a>
</div>
{% endmacro draw_post_short %}

{% macro draw_buttons(current_offset, draw_forward) %}
<div class="d-flex justify-content-evenly">
	{% if current_offset != 0 %}
	<a class="nav-link" href="?offset={{ current_offset - 30 }}">
		<button class="btn btn-lg btn-secondary" type="button">Previous</button>
	</a>
	{% endif %}
	{% if draw_forward %}
	<a class="nav-link" href="?offset={{ current_offset + 30 }}">
		<button class="btn btn-lg btn-secondary" type="button">Next</button>
	</a>
	{% endif %}
</div>
{% endmacro draw_buttons %}

{% macro draw_search_box(previous_title=false, previous_sort) %}
<br>
<div class="container-fluid" style="display: flex; justify-content: center;">
	<form class="nav">
		<div class="row container">
			{% if previous_title != false %}
			<div class="col-6">
				<input class="form-control" type="text" placeholder="Search" name="name" autocomplete="off"
					value="{{ previous_title }}">
			</div>
			{% endif %}
			<div class="col">
				<select name="order" class="form-control" selected="{{ previous_sort }}">
					<option value="latest">Latest</option>
					{% if previous_sort == "popular" %}
					<option value="popular" selected>Popular</option>
					{% else %}
					<option value="popular">Popular</option>
					{% endif %}
				</select>
			</div>
			<div class="col-1">
				<button class="btn btn-secondary" type="submit">Search</button>
			</div>
		</div>
	</form>
</div>
<br>
{% endmacro draw_search_box %}

{% macro btn_success_outer() %}
{% if light_mode %}
btn btn-sm btn-outline-success btn-success
{% else %}
btn btn-sm btn-success
{% endif %}
{% endmacro %}

{% macro btn_success_inner() %}
{% if light_mode %}
btn btn-outline-success
{% else %}
btn
{% endif %}
{% endmacro %}

{% macro btn_info_outer() %}
{% if light_mode %}
btn btn-sm btn-outline-info btn-info
{% else %}
btn btn-sm btn-info
{% endif %}
{% endmacro %}

{% macro btn_info_inner() %}
{% if light_mode %}
btn btn-outline-info
{% else %}
btn
{% endif %}
{% endmacro %}

{% macro btn_danger_outer() %}
{% if light_mode %}
btn btn-sm btn-outline-danger btn-danger
{% else %}
btn btn-sm btn-danger
{% endif %}
{% endmacro %}

{% macro btn_danger_inner() %}
{% if light_mode %}
btn btn-outline-danger
{% else %}
btn
{% endif %}
{% endmacro %}

{% macro draw_post_full(id, name, text, image, link, uploader_id, uploader_name, likes, dislikes, downloads,
is_logged_in=false,
has_liked=false, has_disliked=false, jwt="", who_is_logged_in=0) %}
<script>
	var had_disliked = {{ has_disliked }};
	var had_liked = {{ has_liked }};

	function onLike() {
		options = {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
				'Authorization': 'Bearer {{ jwt }}'
			}
		}
		fetch('/api/v1/posts/{{ id }}/like/', options)
			.then(response => response.json())
			.then(data => {
				document.getElementById('likes').innerHTML = Number(document.getElementById('likes').innerHTML[0]) + 1 + "👍"
				document.getElementById('likes').classList.add("disabled")
				document.getElementById('likedradiobtn').checked = true
				had_liked = true
				if (had_disliked) {
					document.getElementById('dislikes').innerHTML = Number(document.getElementById('dislikes').innerHTML[0]) - 1 + "👎"
					document.getElementById('dislikes').classList.remove("disabled")
					had_disliked = false
					document.getElementById('dislikedradiobtn').checked = false
				}
			})
			.catch(error => console.error(error))
	}

	function onDislike() {
		const options = {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
				'Authorization': 'Bearer {{ jwt }}'
			}
		}
		fetch('/api/v1/posts/{{ id }}/dislike/', options)
			.then(response => response.json())
			.then(data => {
				document.getElementById('dislikes').innerHTML = Number(document.getElementById('dislikes').innerHTML[0]) + 1 + "👎"
				document.getElementById('dislikes').classList.add("disabled")
				document.getElementById('dislikedradiobtn').checked = true
				had_disliked = true
				if (had_liked) {
					document.getElementById('likes').innerHTML = Number(document.getElementById('likes').innerHTML[0]) - 1 + "👍"
					document.getElementById('likes').classList.remove("disabled")
					document.getElementById('likedradiobtn').checked = false
					had_liked = false
				}
			})
			.catch(error => console.error(error))
	}

	function deletePost() {
		const options = {
			method: 'DELETE',
			headers: {
				'Content-Type': 'application/json',
				'Authorization': 'Bearer {{ jwt }}'
			}
		}
		fetch("/api/v1/posts/{{ id }}/delete/", options)
			.then(response => {
				window.location.href = "/"
			})
			.catch(error => console.error(error))
	}
</script>
<div class="row align-items-md-stretch gap-3">
	<div class="col-md-5 card card-body">
		<h2 class="text" style="text-align: center">{{ name | striptags }} </h2>
		<div class="row d-flex align-items-center">
			<div class="col-md">
				<h5>
					<a href=" /user/{{ uploader_id }}" class="card-subtitle text">{{uploader_name |
						striptags }}</a>
				</h5>
			</div>
			<div class="col-md">
				<h5 class="card-subtitle text-align-right-md text">Downloads: {{
					downloads }}</h5>
			</div>
		</div>
		<div class="ratio ratio-16x9">
			<img src="{{ image }}" class="card-img-top">
		</div>
	</div>
	<div class="col-md-5 card card-body h-grid gap-2">
		<div class="btn-group container">
			{% if has_liked %}
			<input type="radio" class="btn-check" name="btnradio" id="likedradiobtn" autocomplete="off" checked="true"
				onclick="onLike()">
			<label class="btn btn-outline-primary disabled" for="likedradiobtn" id="likes">{{ likes }}👍</label>
			<input type="radio" class="btn-check" name="btnradio" id="dislikedradiobtn" autocomplete="off"
				onclick="onDislike()">
			<label class="btn btn-outline-primary" for="dislikedradiobtn" id="dislikes">{{ dislikes
				}}👎</label>
			{% elif has_disliked %}
			<input type="radio" class="btn-check" name="btnradio" id="likedradiobtn" autocomplete="off"
				onclick="onLike()">
			<label class="btn btn-outline-primary" for="likedradiobtn" id="likes">{{ likes
				}}👍</label>
			<input type="radio" class="btn-check" name=" btnradio" id="dislikedradiobtn" checked="true"
				autocomplete="off" onclick="onDislike()">
			<label class="btn btn-outline-primary disabled" for="dislikedradiobtn" id="dislikes">{{ dislikes
				}}👎</label>
			{% elif is_logged_in %}
			<input type="radio" class="btn-check" name="btnradio" id="likedradiobtn" autocomplete="off"
				onclick="onLike()">
			<label class="btn btn-outline-primary" for="likedradiobtn" id="likes">{{ likes }}👍
			</label>
			<input type="radio" class="btn-check" name="btnradio" id="dislikedradiobtn" autocomplete="off"
				onclick="onDislike()">
			<label class="btn btn-outline-primary" for="dislikedradiobtn" id="dislikes">{{ dislikes }}👎
			</label>
			{% else %}
			<input type="radio" class="btn-check" name="btnradio" id="likedradiobtn" autocomplete="off">
			<label class="btn btn-outline-primary disabled" for="likedradiobtn" id="likes">{{ likes }}👍</label>
			<input type="radio" class="btn-check" name="btnradio" id="dislikedradiobtn" autocomplete="off">
			<label class="btn btn-outline-primary disabled" for="dislikedradiobtn" id="dislikes">{{ dislikes
				}}👎</label>
			{% endif %}
		</div>
		<div class="btn-group">
			<a href="{{ link }}" class="{{ self::btn_success_outer() }}" download>
				<button type="button" class="{{ self::btn_success_inner() }}">Download</button>
			</a>
			{% if who_is_logged_in == uploader_id %}
			<a href="/posts/{{ id }}/edit" class="{{ self::btn_info_outer() }}">
				<button type="button" class="{{ self::btn_info_inner() }}">Edit</button>
			</a>
			<div class="{{ self::btn_danger_outer() }}" onclick="deletePost()">
				<button type="button" class="{{ self::btn_danger_inner() }}">Delete</button>
			</div>
			{% endif %}
		</div>
		<div class="container-fluid">
			<h5 class="text">
				{{ text | striptags | linebreaksbr | safe }}
			</h5>
		</div>
	</div>
</div>
{% endmacro draw_post_full %}