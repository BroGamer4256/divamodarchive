{% macro draw_embed(title, description, image) %}
{% if title != "" %}
<title>{{ title }} - DIVA Mod Archive</title>
<meta property="og:title" content="{{ title }}">
{% else %}
<title>DIVA Mod Archive</title>
<meta property="og:title" content="DIVA Mod Archive">
{% endif %}

{% if description != "" %}
<meta name="description" content="{{ description }}">
<meta property="og:description" content="{{ description }}">
{% endif %}

{% if image != "" %}
<meta property="og:image" content="{{ image }}">
<meta name="twitter:card" content="summary_large_image">
{% endif %}
<meta property="og:site_name" content="DIVA Mod Archive">
{% endmacro %}

<!doctype html>
<html lang="en">

<head>
	<meta charset="utf8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	{% block head %}{% endblock %}
	{% if base.theme() == Theme::Light %}
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.3/zephyr/bootstrap.min.css" rel="stylesheet">
	{% else if base.theme() == Theme::Dark %}
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.3/darkly/bootstrap.min.css" rel="stylesheet">
	{% endif %}
	<link rel="shortcut icon" href="https://divamodarchive.com/favicon.ico" />
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" async></script>

	<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20,500,1,100&icon_names=download,favorite,star" rel="stylesheet" />

	<script>
		function getPostHtml(post) {
			var div = document.createElement('div');
			div.classList = ["col"];
			div.innerHTML = `
<div class="card shadow-sm">
	<a style="text-decoration: none;" href="/post/${post.id}">
		<div class="card-img-top ratio ratio-16x9 bg-clear border-none" loading="lazy">
			<img src="${post.images[0]}" class="rounded-image" width="100%" loading="lazy">
		</div>
		<div class="card-body">
			<h5 class="text">${post.name.substring(0, 20)}${post.name.length > 20 ? "..." : ""}</h5>
			<h5 class="row">
				<div class="col-md-7 text">${post.like_count}<span class="material-symbols-outlined" style="font-size: 1rem">favorite</span> ${post.download_count}<span class="material-symbols-outlined" style="font-size: 1rem">download</span></div>
				<div class="col-md-5 text text-align-right-md">
					${post.post_type}
				</div>
			</h5>
		</div>
	</a>
</div>
			`;
			return div;
		}

		async function search(query, sort, filter, offset) {
			var params = new URLSearchParams();
			if (query != null) params.append("query", query);
			if (sort != null) params.append("sort", sort);
			if (filter != null) params.append("filter", filter);
			if (offset != null) params.append("offset", offset);
			params.append("limit", "20");

			var options = {
				method: 'GET',
			}

			return await fetch("https://divamodarchive.com/api/v1/posts?" + params.toString(), options).then(req => req.json());
		}

		function logout() {
			document.cookie = "authorization=;Max-Age=0";
			document.location.reload();
		}
	</script>

	<style>
		.text {
			color: var(--bs-body-color) !important;
		}

		.nav-link:hover {
			{% if base.theme() == Theme::Light %}
			color: var(--bs-secondary-rgb) !important;
			{% else if base.theme() == Theme::Dark %}
			color: var(--bs-body-color-rgb) !important;
			{% endif %}
		}

		.nav-link {
			{% if base.theme() == Theme::Light %}
			color: rgba(var(--bs-secondary-rgb), 0.75) !important;
			{% else if base.theme() == Theme::Dark %}
			color: rgba(var(--bs-body-color-rgb), 0.75) !important;
			{% endif %}
		}

		.rounded-image {
			border-radius: var(--bs-card-border-radius) var(--bs-card-border-radius) 0 0;
			object-fit: contain;
		}

		.flat-image {
			border-radius: 0;
			object-fit: contain;
		}

		::placeholder {
			color: var(--bs-dark) !important;
		}

		.fit {
			width: fit-content;
			block-size: fit-content;
		}

		.line {
			width: 2px;
			height: 100%;
			background-color: var(--bs-card-cap-bg) !important;
		}

		.col-small {
			flex: 0 0 auto;
			width: 1%;
		}

		@media (min-width: 768px) {
			.text-align-right-md {
				text-align: right;
			}
		}

		.text-align-right {
			text-align: right;
		}

		.bg-clear {
			background-color: transparent !important;
		}

		.border-none {
			border: none !important;
		}

		:root {
			--diva-easy: #00bedc;
			--diva-normal: #30c200;
			--diva-hard: #dcaa00;
			--diva-extreme: #e65050;
			--diva-exex: #a650c4;
		}
	</style>
</head>

<body>
	<br>
	<div id="content" class="container">
		<main>
			{% block content %}{% endblock %}
		</main>
	</div>
	<br><br><br><br><br>
	<footer>
		<nav class="navbar navbar-dark bg-dark fixed-bottom d-flex justify-content-around shadow">
			<a class="nav-link p-0 nav-text" href="/">Mods</a>
			{% if let Some(user) = base.user %}
			<a class="nav-link p-0 nav-text" href="/liked/{{ user.id }}">Liked Mods</a>
			<a class="nav-link p-0 nav-text" href="/upload">Upload</a>
			<a class="nav-link p-0 nav-text" href="/settings">Settings</a>
			<button class="nav-link p-0 nav-text" onclick="logout()">Logout</button>
			{% if user.is_admin(base.config) %}
			<a class="nav-link p-0 nav-text" href="/admin">Admin{% if let Some(report_count) = base.report_count %} - {{ report_count }}{% endif %}</a>
			{% endif %}
			{% else %}
			{% let discord_id = base.config.discord_id.clone() %}
			{% let discord_link =
			format!("https://discord.com/api/oauth2/authorize?client_id={discord_id}&redirect_uri={}&response_type=code&scope=identify",
			url::form_urlencoded::byte_serialize("https://divamodarchive.com/login".as_bytes()).collect::<String>()) %}
			<a class="nav-link p-0 nav-text" href="{{ discord_link }}">Login</a>
			{% endif %}
			<a class="nav-link p-0 nav-text" href="/about">About</a>
		</nav>
	</footer>
</body>

</html>
